<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Átíró (Élő Loggal)</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 40px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        h1, h2 { text-align: center; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="file"] { width: 100%; padding: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
        button:disabled { background-color: #aaa; }
        #log-container { margin-top: 30px; }
        #log { background-color: #222; color: #0f0; font-family: monospace; white-space: pre-wrap; padding: 15px; border-radius: 5px; height: 300px; overflow-y: scroll; word-wrap: break-word; }
    </style>
</head>
<body>

    <h1>Audio Fájl Átírása</h1>
    
    <form id="transcribe-form">
        <div class="form-group">
            <label for="api_key">Speechmatics API Kulcs:</label>
            <input type="text" id="api_key" name="api_key" required>
        </div>
        
        <div class="form-group">
            <label for="file">Hangfájl kiválasztása:</label>
            <input type="file" id="file" name="file" accept="audio/*" required>
        </div>
        
        <button type="submit" id="submit-button">Átírás indítása</button>
    </form>

    <div id="log-container">
        <h2>Élő Log</h2>
        <pre id="log"></pre>
    </div>

    <script>
        const form = document.getElementById('transcribe-form');
        const logElement = document.getElementById('log');
        const submitButton = document.getElementById('submit-button');

        form.addEventListener('submit', async function(event) {
            // Megakadályozzuk az oldal újratöltését
            event.preventDefault();

            // Gomb letiltása és log törlése a folyamat idejére
            submitButton.disabled = true;
            submitButton.textContent = 'Feldolgozás folyamatban...';
            logElement.textContent = '';

            // Az űrlap adatainak összegyűjtése
            const formData = new FormData(form);

            try {
                // A fetch API segítségével elindítjuk a kérést
                const response = await fetch('/transcribe', {
                    method: 'POST',
                    body: formData,
                });

                // A válasz egy stream, amit olvasni kezdünk
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                // Ciklus, ami addig fut, amíg a stream nyitva van
                while (true) {
                    const { value, done } = await reader.read();
                    if (done) {
                        break; // A stream véget ért
                    }
                    
                    // A kapott adatokat szöveggé alakítjuk
                    const chunk = decoder.decode(value);

                    // Az SSE formátum miatt a "data: " részt le kell vágni
                    const lines = chunk.split('\n');
                    lines.forEach(line => {
                        if (line.startsWith('data: ')) {
                            const message = line.substring(6); // Vágjuk le a "data: " részt
                            logElement.textContent += message + '\n';
                            // Automatikus görgetés az aljára
                            logElement.scrollTop = logElement.scrollHeight;
                        }
                    });
                }
            } catch (error) {
                logElement.textContent += 'Hálózati vagy kliens oldali hiba történt: ' + error + '\n';
            } finally {
                // Gomb visszaállítása a folyamat végén
                submitButton.disabled = false;
                submitButton.textContent = 'Átírás indítása';
            }
        });
    </script>

</body>
</html>
